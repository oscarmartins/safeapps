<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <div class="page-title">
        <h1>Dashboard </h1>
    </div>


<div id="layout2" style="width: 100%; height: 300px;"></div>

<div style="height: 20px;"></div>


<script type="text/javascript">
    var isPopupActivated = false;

    function orcLoadGrid (name, action, columns, timer, cb) {
        orcmanager.w2uiGlobal.destroy(name);
        this.options = { 
            name: name, 
            url: orcsettings.server.serverUrlApi, //'app/simulator/list.json',
            method: 'POST', // need this to avoid 412 error on Safari
            postData: {
                REQ_CONTEX : 9999, 
                REQ_ACTION : action,
                REQ_INPUTS: {origin:'w2ui'}
            },
            columns: columns
        }
        setTimeout(function (opt, callBack) {
            $().w2grid(opt)
            if (typeof callBack === 'function')
                setTimeout(callBack, 50)
        }, (timer || 120), this.options, cb) 
    }


    $(function () {
        var pstyle = 'border: 1px solid #dfdfdf; padding: 5px;';
        if(w2ui['layout2']){
            orcmanager.w2uiGlobal.destroy('layout2');
        }
        $('#layout2').w2layout({
            name: 'layout2',
            panels: [
                { type: 'left', size: 500, resizable: false, style: pstyle, title: 'Users'},
                //{ type: 'right', size: 200, resizable: true, style: pstyle,},
                { type: 'main', style: pstyle, resizable: false, title: 'Accounts'}
            ],
            onRender: function () { 
                            
            }
        });
               
        orcLoadGrid('users_sys', 1290, [                
                { field: 'id', caption: 'User ID', size: '30%' },
                { field: 'name', caption: 'User Name', size: '30%' },
                { field: 'email', caption: 'User Email', size: '40%' }
            ],250, function () {
                w2ui.layout2.content('left', w2ui.users_sys)
                w2ui['users_sys'].on('error', function(event) {
                    new ServerActions().verify({action: 'refreshAll'})
                });
            })
        orcLoadGrid('accoounts_sys', 12100, [                
                { field: 'user_id', caption: 'CÓDIGO UTLIZADOR', size: '20%' },
                { field: 'accountStatus', caption: 'ESTADO DA CONTA', size: '20%' },
                { field: 'nextStage', caption: 'Proximo Estágio', size: '20%' },
                { field: 'code', caption: 'CÓDIGO SEGURANÇA', size: '20%' },
                { field: 'dateCreated', caption: 'Data Criação', size: '20%', render: function (record, index, col_index) {
                    var etad = new Date(Date.parse(this.getCellValue(index, col_index)))
                    return etad.getDate() +'/' + ((etad.getMonth()+1)) + '/' + etad.getFullYear()                   
                } },
                { field: 'dateUpdated', caption: 'Ultimo Update', size: '20%', render: 'date', render: function (record, index, col_index) {
                    var etad = new Date(Date.parse(this.getCellValue(index, col_index)))
                    return etad.getDate() +'/' + ((etad.getMonth()+1)) + '/' + etad.getFullYear()                   
                } },
            ],500, function () {
                w2ui.layout2.content('main', w2ui.accoounts_sys)
                w2ui['accoounts_sys'].on('error', function(event) {
                    new ServerActions().verify({action: 'refreshAll'})
                });
            })

        /**
        $().w2grid({ 
            name: 'users_sys', 
            url: orcsettings.server.serverUrlApi, //'app/simulator/list.json',
            method: 'POST', // need this to avoid 412 error on Safari
            postData: {
                REQ_CONTEX : 9999, 
                REQ_ACTION : 1290,
                REQ_INPUTS: {origin:'w2ui'}
            },
            columns: [                
                { field: 'id', caption: 'User ID', size: '30%' },
                { field: 'name', caption: 'User Name', size: '30%' },
                { field: 'email', caption: 'User Email', size: '40%' }
            ]
        });    

        
        $().w2grid({ 
            name: 'accoounts_sys', 
            url: orcsettings.server.serverUrlApi, //'app/simulator/list.json',
            method: 'POST', // need this to avoid 412 error on Safari
            postData: {
                REQ_CONTEX : 9999, 
                REQ_ACTION : 12100,
                REQ_INPUTS: {origin:'w2ui'}
            },
            columns: [                
                { field: 'user_id', caption: 'CÓDIGO UTLIZADOR', size: '20%' },
                { field: 'accountStatus', caption: 'ESTADO DA CONTA', size: '20%' },
                { field: 'nextStage', caption: 'Proximo Estágio', size: '20%' },
                { field: 'code', caption: 'CÓDIGO SEGURANÇA', size: '20%' },
                { field: 'dateCreated', caption: 'Data Criação', size: '20%' },
                { field: 'dateUpdated', caption: 'Ultimo Update', size: '20%' },
            ]
        });    

         user_id: {type: Schema.Types.ObjectId, required: true},
  accountStatus: {type: Number, required: true},
  nextStage: {type: Number, required: true},
  code: {type: String},
  dateCreated: {type: Date},
  dateUpdated: {type: Date}
         * **/

        setTimeout(() => {
            if (isPopupActivated) {
                showPopup()
                isPopupActivated = false
            }            
        }, 500);
    });
    function showMessage(panel) {
        w2ui.layout2.message('main', {
            width: 300,
            height: 150,
            body: '<div class="w2ui-centered">Some Text '+ (new Date()).getTime() +'</div>',
            buttons: '<button class="w2ui-btn" onclick="w2ui.layout.message(\'main\')">Ok</button>' 
        })
    }
    function showPopup() {
        w2popup.open({
            title: 'Popup Title',
            body: '<div class="w2ui-centered">This is text inside the popup</div>',
            onClose: function (event) { 
                console.log('close'); 
            }
         });
    }

    </script>
</body></html>